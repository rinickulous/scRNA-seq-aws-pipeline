/*
========================================================================================
    Base Process Configuration
========================================================================================
*/

process {
    
    // Default error strategy
    errorStrategy = 'terminate'
    
    // Default resources
    cpus = { check_max( 1, 'cpus' ) }
    memory = { check_max( 4.GB, 'memory' ) }
    time = { check_max( 4.h, 'time' ) }
    
    // Process labels for resource allocation
    withLabel: process_low {
        cpus = { check_max( 2, 'cpus' ) }
        memory = { check_max( 8.GB, 'memory' ) }
        time = { check_max( 4.h, 'time' ) }
    }
    
    withLabel: process_medium {
        cpus = { check_max( 4, 'cpus' ) }
        memory = { check_max( 16.GB, 'memory' ) }
        time = { check_max( 8.h, 'time' ) }
    }
    
    withLabel: process_high {
        cpus = { check_max( 8, 'cpus' ) }
        memory = { check_max( 32.GB, 'memory' ) }
        time = { check_max( 16.h, 'time' ) }
    }
    
    withLabel: process_long {
        time = { check_max( 24.h, 'time' ) }
    }
    
    withLabel: process_high_memory {
        memory = { check_max( 128.GB, 'memory' ) }
    }
    
    // Capture exit codes from upstream processes
    shell = ['/bin/bash', '-euo', 'pipefail']
    
    // Prevent local Python libraries from conflicting with container
    containerOptions = { workflow.containerEngine == "docker" ? '-u $(id -u):$(id -g)' : null }
}